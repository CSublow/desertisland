{% extends 'base.html' %}

{% block content %}
    <main>
        <!-- The heading won't display on the page for most users for stylistic reasons.
            Screen reader users however still benefit from know what page they are on 
        -->
        <h1 class="sr-only">Home</h1>
        
        <!-- Top Parallax Image -->
        <div class="parallax-container">
            <div class="parallax">
                <img src="{{ url_for('static', filename='images/index_1.jpg') }}">
            </div>
            
            <div class="valign-wrapper center-align">
                <p>The World's Favorite Songs, Voted By You</p>
            </div>
        </div>
        <!-- /Top Parallax Image -->
        
        <div class="divider parallax-divider"></div>
        
        <!-- Current Top 3 Tracks Section -->
        <section class="container ix-top-tracks">
            <h2 class="center-align">Current Top 3 Tracks</h2>
            
            <div class="divider"></div>
        
            {% for track in tracks %}
                <!-- Limit the returned tracks to 3.
                     Since the list has already been sorted by upvotes descending in app.py, 
                     the returned tracks will be the 3 highest upvoted tracks 
                -->
                {% if loop.index <= 3 %}
                    <div class="row center-align">
                        <div class="col s12 l6">
                            <p class="flow-text reset-margin-top">
                                <!-- If the user clicks on the artist - track text in the list of top 3, they will be taken to that particular track's track-detail page. 
                                    The track detail view requires a decade_filter and sorting_order, 
                                    this is for the benefit of the chart's page (to keep the values for decade_filter and sorting_order the user has currently set).
                                    However, coming from the index the user hasn't changed decade_filter or sorting order,
                                    so these values can just be defaults -->
                                <a href="{{ url_for('track_detail', decade_filter = 'all', sorting_order = 1, track_id = track._id) }}">
                                    {{ loop.index }}. {{ track.artist}} - {{ track.track_title }}
                                </a>
                            </p>
                                
                            <span class="flow-text">{{ track.upvotes }} upvotes</span>
                        </div>
                        
                        <div class="ix-youtube-iframe-container col s12 l6">
                            <iframe src="https://www.youtube.com/embed/{{ track.youtube_link|replace('https://www.youtube.com/watch?v=', '') }}" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
                        </div>
                    </div>
                    
                    {% if loop.index <= 2 %}
                        <div class="divider"></div>
                    {% endif %}
                {% endif %}
            {% endfor %}
            
            <!-- View More Link -->
            <div class="row">
                <div class="col s12 center-align">
                    <a class="flow-text view-more-link" href="{{ url_for('sort_tracks_upvote_desc', decade_filter = 'all') }}">View The Full Charts</a>
                </div>
            </div>
            <!-- /View More Link -->
        </section>
        <!-- /Current Top 3 Tracks Section -->
        
        <div class="divider parallax-divider"></div>
        
        <!-- Bottom Parallax Image -->
        <div class="parallax-container">
            <div class="parallax">
                <img src="{{ url_for('static', filename='images/index_2.jpg') }}">
            </div>
            
            <div class="valign-wrapper center-align">
                <p><a href="{{ url_for('sort_tracks_upvote_desc', decade_filter = 'all') }}">Help Us Find The Most Loved Music Of All Time</a></p>
            </div>
        </div>
        <!-- /Bottom Parallax Image -->
        
        <div class="divider"></div>
    </main>
{% endblock %}

<!-- Parallax Effect -->
{% block parallax %}
    <script>
        /* Parallax Effect */
        $(document).ready(function() {
            $('.parallax').parallax();  
        })
    </script>
{% endblock %}
<!-- /Parallax Effect -->