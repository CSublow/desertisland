{% extends 'base.html' %}

{% block content %}
    <main class="container">
        <div class="row">
            <a class="col s3" href="{{ url_for('sort_tracks_upvote_desc', decade_filter = decade_filter) }}">Sort by Most Popular</a>
            <a class="col s3" href="{{ url_for('sort_tracks_date_added_desc', decade_filter = decade_filter) }}">Sort by Date Added (Newest)</a>
            <div class="col s3">
                <label for="decade-options-select">Filter tracks by decade</label>
                <select id="decade-options-select" name="decade-options-select">
                    <option value="all">Show All</option>
                    <option value="pre1950">Pre-1950</option>
                    <option value="1950s">1950-1959</option>
                    <option value="1960s">1960-1969</option>
                    <option value="1970s">1970-1979</option>
                    <option value="1980s">1980-1989</option>
                    <option value="1990s">1990-1999</option>
                    <option value="2000s">2000-2009</option>
                    <option value="2010s">2010-2019</option>
                </select>     
            </div>
        </div>
        <div class="row">
            <a class="col s3" href="{{ url_for('sort_tracks_upvote_asc', decade_filter = decade_filter) }}">Sort by Least Popular</a>
            <a class="col s3" href="{{ url_for('sort_tracks_date_added_asc', decade_filter = decade_filter) }}">Sort by Date Added (Oldest)</a>
        </div>
        <!-- Accordion Container -->
        <ul class="collapsible">
            {% for track in tracks %} <!-- For each track in the database -->
            <li>
                <!-- Accordion Header -->
                <div class="collapsible-header">
                    <!-- Rank. Artist - Title -->
                    <!-- Rank is determined by adding the current pagination value to the loop index -->
                    <i class="material-icons">arrow_drop_down</i>
                    {{ loop.index + pagination }}. {{ track.artist }} - {{ track.track_title }}
                    <!-- /Artist - Title -->
                    <!-- Upvote Button -->
                    <form action="{{ url_for('upvote_track', sorting_order = sorting_order, track_id = track._id) }}" method="POST">
                        <button type="submit">
                            <i class="material-icons">arrow_upward</i>
                        </button>
                        {{ track.upvotes }}
                    </form>
                    <!-- /Upvote Button -->
                    {{ track.date_added }}
                    <!-- Edit Button -->
                    <a href="{{url_for('edit_track', decade_filter = decade_filter, sorting_order = sorting_order, track_id = track._id)}}" class="waves-effect waves-light btn btn_small blue">Edit</a>
                    <!-- Delete Button -->
                    <a href="{{url_for('delete_track', decade_filter = decade_filter, sorting_order = sorting_order, track_id=track._id)}}" class="waves-effect waves-light btn btn_small red">Delete</a>
                </div>
                <!-- /Accordion Header -->
                <!-- Accordion Body -->
                <div class="collapsible-body">
                    <span>Released in {{ track.year }}</span>
                    <p>{{ track.genre }}</p>
                </div>
                <!-- /Accordion Body -->
                <!-- YouTube Video -->
                <iframe width="560" height="315" src="https://www.youtube.com/embed/{{ track.youtube_link|replace('https://www.youtube.com/watch?v=', '') }}" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
                <!-- /YouTube Video -->
            </li>
            {% endfor %}
        </ul>
        <!-- /Accordion Container -->
        
        <!-- Previous arrow -->
        {% if pagination %}
            <a href="{{ url_for('prev_tracks', decade_filter = decade_filter, sorting_order = sorting_order) }}">Previous</a>
        {% endif %}
        <!-- Next arrow -->
        {% if pagination < tracks_count - 5 %}
            <a href="{{ url_for('next_tracks', decade_filter = decade_filter, sorting_order = sorting_order) }}">Next</a>
        {% endif %}
        {{ pagination }}
        {{ tracks_col_count }}
        {{ rankings }}
    </main>
{% endblock %}

<!-- Decade Link Script -->
{% block decade_link_js %}
    <script>
        // Listen for a change on the Genre select box
        $('#decade-options-select').change(function() {
            // Grab the current value of the select box
            var selectVal = $('#decade-options-select').val()
            console.log(selectVal)
            // If the select box's value is equal to 'add-genre-link'...
            switch (selectVal) {
                case 'pre1950':
                    window.location.href = "{{ url_for('get_tracks', sorting_order = sorting_order, decade_filter = 'pre1950' ) }}";
                    break;
            
                case '1950s':
                    window.location.href = "{{ url_for('get_tracks', sorting_order = sorting_order, decade_filter = '1950s' ) }}";
                    break;
            
                case '1960s':
                    window.location.href = "{{ url_for('get_tracks', sorting_order = sorting_order, decade_filter = '1960s' ) }}";
                    break;
            
                case '1970s':
                    window.location.href = "{{ url_for('get_tracks', sorting_order = sorting_order, decade_filter = '1970s' ) }}";
                    break;
                    
                case '1980s':
                    window.location.href = "{{ url_for('get_tracks', sorting_order = sorting_order, decade_filter = '1980s' ) }}";
                    break;
                    
                case '1990s':
                    window.location.href = "{{ url_for('get_tracks', sorting_order = sorting_order, decade_filter = '1990s' ) }}";
                    break;
                    
                case '2000s':
                    window.location.href = "{{ url_for('get_tracks', sorting_order = sorting_order, decade_filter = '2000s' ) }}";
                    break;
                    
                case '2010s':
                    window.location.href = "{{ url_for('get_tracks', sorting_order = sorting_order, decade_filter = '2010s' ) }}";
                    break;
                    
                default:
                    window.location.href = "{{ url_for('get_tracks', sorting_order = sorting_order, decade_filter = 'all' ) }}";
                    break;
            }
        });
        // This functionality would be easier with a click event
        // Unfortunately however, Chrome doesn't work with click events on select options
    </script>
    
        {% if decade_filter == 'pre1950' %}
            <script>
                $(document).ready(function() {
                    $("#decade-options-select option[value='pre1950']").prop("selected",true);
                    $('#decade-options-select').material_select();
                });
            </script>
        {% elif decade_filter == '1950s' %}
            <script>
                $(document).ready(function() {
                    $("#decade-options-select option[value='pre1950']").prop("selected",true);
                    $('#decade-options-select').material_select();
                });
            </script>
        {% elif decade_filter == '1960s' %}
            <script>
                $(document).ready(function() {
                    $("#decade-options-select option[value='1960s']").prop("selected",true);
                    $('#decade-options-select').material_select();
                });
            </script>
        {% elif decade_filter == '1970s' %}
            <script>
                $(document).ready(function() {
                    $("#decade-options-select option[value='1970s']").prop("selected",true);
                    $('#decade-options-select').material_select();
                });
            </script>
        {% elif decade_filter == '1980s' %}
            <script>
                $(document).ready(function() {
                    $("#decade-options-select option[value='1980s']").prop("selected",true);
                    $('#decade-options-select').material_select();
                });
            </script>
        {% elif decade_filter == '1990s' %}
            <script>
                $(document).ready(function() {
                    $("#decade-options-select option[value='1990s']").prop("selected",true);
                    $('#decade-options-select').material_select();
                });
            </script>
        {% elif decade_filter == '2000s' %}
            <script>
                $(document).ready(function() {
                    $("#decade-options-select option[value='2000s']").prop("selected",true);
                    $('#decade-options-select').material_select();
                });
            </script>
        {% elif decade_filter == '2010s' %}
            <script>
                $(document).ready(function() {
                    $("#decade-options-select option[value='2010s']").prop("selected",true);
                    $('#decade-options-select').material_select();
                });
            </script>
        {% else %}
            <script>
                $(document).ready(function() {
                    $("#decade-options-select option[value='all']").prop("selected",true);
                    $('#decade-options-select').material_select();
                });
            </script>
        {% endif %}

{% endblock %}